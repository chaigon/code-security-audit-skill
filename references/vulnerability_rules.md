# 各语言安全漏洞检查规则

## 目录

- [通用规则](#通用规则)
- [Python](#python)
- [Node.js / JavaScript](#nodejs--javascript)
- [Go](#go)
- [Java](#java)

---

## 通用规则

### 敏感信息泄露
- 硬编码密码、API Key、Token、Secret
- 搜索模式: `password\s*=`, `api_key`, `secret`, `token`, `AWS_ACCESS_KEY`, `PRIVATE_KEY`
- .env 文件是否被 .gitignore 排除
- 日志中是否打印敏感信息

### 注入类漏洞
- SQL 注入: 字符串拼接构造 SQL 语句
- 命令注入: 用户输入直接传入 shell 命令
- LDAP 注入、XPath 注入、模板注入

### 认证与授权
- 弱密码策略
- 缺少认证中间件
- 水平/垂直越权
- JWT 配置不当（无过期、弱密钥、alg=none）
- Session 固定攻击

### 加密问题
- 使用弱加密算法: MD5, SHA1, DES, RC4
- ECB 模式
- 硬编码 IV/Salt
- 不安全的随机数生成

### 配置安全
- DEBUG 模式在生产环境开启
- CORS 配置过于宽松 (`*`)
- 缺少安全 HTTP 头 (CSP, HSTS, X-Frame-Options)
- 不安全的 TLS 配置

---

## Python

### 高危
- `eval()`, `exec()`, `compile()` 使用用户输入
- `pickle.loads()` 反序列化不可信数据
- `yaml.load()` 未使用 `SafeLoader`
- `subprocess.call(shell=True)` + 用户输入
- `os.system()` + 字符串拼接
- `__import__()` 动态导入
- Flask/Django `DEBUG=True` 在生产环境
- `render_template_string()` + 用户输入 (SSTI)

### 中危
- `requests.get(verify=False)` 禁用 SSL 验证
- `hashlib.md5()` / `hashlib.sha1()` 用于密码
- `random` 模块用于安全场景（应使用 `secrets`）
- Django `ALLOWED_HOSTS = ['*']`
- Flask `secret_key` 硬编码
- SQLAlchemy `text()` + 字符串拼接

### 低危
- 未设置 `httponly` / `secure` cookie 标志
- 缺少 CSRF 保护
- 过于宽泛的异常捕获 `except Exception`
- 未限制文件上传大小/类型

### 依赖文件
- `requirements.txt`, `Pipfile`, `Pipfile.lock`, `pyproject.toml`, `setup.py`, `setup.cfg`
- 审计工具: `pip-audit`, `safety`, `bandit`

---

## Node.js / JavaScript

### 高危
- `eval()`, `Function()`, `vm.runInNewContext()` + 用户输入
- `child_process.exec()` + 字符串拼接
- `require()` 动态路径 + 用户输入
- `innerHTML` / `dangerouslySetInnerHTML` + 未转义输入 (XSS)
- `new Function(userInput)` 代码注入
- 原型污染: `Object.assign({}, userInput)`, `_.merge`
- `express` 未使用 `helmet`
- `jsonwebtoken` 使用 `algorithms: ['none']`

### 中危
- `cors({ origin: '*' })` 过于宽松
- `express.static()` 路径遍历
- `fs.readFile(userInput)` 路径遍历
- `crypto.createCipher()` (已废弃，应使用 `createCipheriv`)
- `Math.random()` 用于安全场景
- 缺少 rate limiting
- `npm` 包 typosquatting 风险

### 低危
- 未设置 `sameSite` cookie 属性
- `console.log` 打印敏感信息
- 未处理的 Promise rejection
- 缺少输入长度限制

### 依赖文件
- `package.json`, `package-lock.json`, `yarn.lock`, `pnpm-lock.yaml`
- 审计工具: `npm audit`, `yarn audit`, `snyk`

---

## Go

### 高危
- `database/sql` 字符串拼接 SQL（应使用参数化查询）
- `os/exec.Command()` + 用户输入
- `html/template` 中使用 `template.HTML()` 绕过转义
- `net/http` 未设置超时 (DoS 风险)
- `crypto/rand` 未使用（使用了 `math/rand`）
- `unsafe` 包的不当使用
- `cgo` 中的内存安全问题

### 中危
- `http.ListenAndServe` 未使用 TLS
- `tls.Config{InsecureSkipVerify: true}`
- `ioutil.ReadAll` 未限制大小 (OOM 风险)
- `filepath.Join` + 用户输入未校验 (路径遍历)
- `json.Unmarshal` 到 `interface{}` 未校验类型
- goroutine 泄露（无 context 取消）

### 低危
- 未使用 `defer` 关闭资源
- 错误被忽略 `_ = someFunc()`
- 缺少 context 传播
- 未设置 CORS 中间件

### 依赖文件
- `go.mod`, `go.sum`
- 审计工具: `govulncheck`, `gosec`

---

## Java

### 高危
- SQL 注入: `Statement` + 字符串拼接（应使用 `PreparedStatement`）
- `Runtime.getRuntime().exec()` + 用户输入
- `ObjectInputStream.readObject()` 反序列化不可信数据
- XXE: `DocumentBuilderFactory` 未禁用外部实体
- SSRF: `URL.openConnection()` + 用户输入
- SpEL 表达式注入
- Log4j JNDI 注入 (`${jndi:ldap://}`)
- Fastjson `autoType` 开启

### 中危
- `MessageDigest.getInstance("MD5")` 用于密码
- `SecureRandom` 使用固定种子
- Spring `@CrossOrigin` 过于宽松
- Mybatis `${}` 拼接（应使用 `#{}`）
- `File` 操作未校验路径
- Swagger/OpenAPI 在生产环境暴露
- Spring Actuator 端点未保护

### 低危
- 异常信息泄露堆栈跟踪
- 未使用 `finally` 关闭资源（Java 7+ 应使用 try-with-resources）
- `@RequestMapping` 未限制 HTTP 方法
- 缺少输入校验注解 (`@Valid`, `@NotNull`)

### 依赖文件
- `pom.xml`, `build.gradle`, `build.gradle.kts`
- 审计工具: `OWASP dependency-check`, `SpotBugs`, `FindSecBugs`
