# 审计报告模板

## 报告输出格式

### 终端输出格式

```
══════════════════════════════════════════════════
  代码安全审计报告
  项目: {项目名称}
  日期: {日期}
  语言: {检测到的语言}
══════════════════════════════════════════════════

📊 审计摘要
──────────────────────────────────────────────────
  严重: {N} | 高危: {N} | 中危: {N} | 低危: {N} | 信息: {N}
──────────────────────────────────────────────────

🔴 严重 / 高危发现
──────────────────────────────────────────────────
[CRITICAL-001] {漏洞标题}
  类型: {漏洞类型, 如 SQL注入}
  位置: {file_path}:{line_number}
  描述: {简要描述}
  数据流: {Source} → {Propagation} → {Sink}
  代码片段:
    ```
    {相关代码}
    ```
  修复建议: {具体修复方案}
  参考: {CWE/CVE 编号}

🟡 中危发现
──────────────────────────────────────────────────
[MEDIUM-001] ...

🔵 低危 / 信息
──────────────────────────────────────────────────
[LOW-001] ...

📦 依赖审计结果
──────────────────────────────────────────────────
  已扫描依赖: {N}
  存在已知漏洞: {N}

  [DEP-001] {包名}@{版本}
    漏洞: {CVE编号} ({严重程度})
    描述: {漏洞描述}
    修复版本: {安全版本}

⚙️ 配置审计
──────────────────────────────────────────────────
[CFG-001] {配置问题}
  文件: {配置文件路径}
  问题: {描述}
  建议: {修复建议}

🔍 业务逻辑与访问控制审计
──────────────────────────────────────────────────

攻击面摘要:
  API 端点总数: {N}
  需认证端点: {N} | 无认证端点: {N}
  GET 写操作: {N} | 缺少 CSRF 保护: {N}

[BIZ-001] {漏洞标题}
  类型: {IDOR / Mass Assignment / 业务规则绕过 / CSRF / 反自动化}
  位置: {file_path}:{line_number}
  描述: {简要描述}
  攻击场景: {具体利用方式}
  修复建议: {具体修复方案}
  参考: {CWE 编号}

🔗 攻击链分析
──────────────────────────────────────────────────
[CHAIN-001] {攻击链名称}
  链路: {漏洞A} → {漏洞B} → {漏洞C}
  前置条件: {攻击者需要的初始条件}
  攻击路径:
    1. 利用 {漏洞A ID} {描述} → 获得 {中间结果}
    2. 利用 {漏洞B ID} {描述} → 获得 {最终结果}
  组合影响: {最终影响描述}
  组合等级: {Critical/High}
  修复建议: 修复 {根漏洞ID} 可阻断整条链路

📋 修复优先级建议
──────────────────────────────────────────────────
1. [CRITICAL-001] {标题} - 立即修复
2. [HIGH-001] {标题} - 尽快修复
3. ...
```

### Markdown 报告格式

当用户请求生成报告文件时，使用以下结构输出到 `security-audit-report.md`:

```markdown
# 代码安全审计报告

| 项目 | 值 |
|------|------|
| 项目名称 | {name} |
| 审计日期 | {date} |
| 检测语言 | {languages} |
| 审计范围 | {scope} |

## 审计摘要

| 严重程度 | 数量 |
|----------|------|
| 🔴 严重 (Critical) | N |
| 🟠 高危 (High) | N |
| 🟡 中危 (Medium) | N |
| 🔵 低危 (Low) | N |
| ⚪ 信息 (Info) | N |

## 漏洞详情

### [ID] 漏洞标题

- **严重程度**: Critical/High/Medium/Low
- **类型**: CWE-XXX 漏洞类型名称
- **位置**: `file:line`
- **描述**: ...
- **数据流**: `Source` → `Propagation` → `Sink`
- **代码片段**:
  ```lang
  vulnerable code
  ```
- **修复建议**:
  ```lang
  fixed code
  ```

## 依赖审计

| 包名 | 当前版本 | 漏洞 | 严重程度 | 修复版本 |
|------|---------|------|---------|---------|
| ... | ... | CVE-... | ... | ... |

## 配置审计

| 文件 | 问题 | 严重程度 | 建议 |
|------|------|---------|------|
| ... | ... | ... | ... |

## 业务逻辑与访问控制审计

### 攻击面摘要

| 指标 | 数量 |
|------|------|
| API 端点总数 | N |
| 需认证端点 | N |
| 无认证端点 | N |
| GET 写操作 | N |
| 缺少 CSRF 保护 | N |

### IDOR / 越权访问

| 端点 | 问题 | 严重程度 | 描述 |
|------|------|---------|------|
| ... | ... | ... | ... |

### Mass Assignment

| 端点 | 可注入字段 | 严重程度 | 修复建议 |
|------|-----------|---------|---------|
| ... | ... | ... | ... |

### 业务规则绕过

| 位置 | 问题 | 严重程度 | 攻击场景 |
|------|------|---------|---------|
| ... | ... | ... | ... |

### CSRF / 反自动化

| 端点 | 问题类型 | 严重程度 | 建议 |
|------|---------|---------|------|
| ... | ... | ... | ... |

## 攻击链分析

### [CHAIN-001] 攻击链名称

- **链路**: 漏洞A → 漏洞B → 漏洞C
- **前置条件**: 攻击者需要的初始条件
- **攻击路径**:
  1. 利用 `漏洞A ID` — 描述 → 获得中间结果
  2. 利用 `漏洞B ID` — 描述 → 获得最终结果
- **组合影响**: 最终影响描述
- **组合等级**: Critical/High
- **修复建议**: 修复根漏洞可阻断整条链路

## 修复优先级

1. **立即修复**: ...
2. **尽快修复**: ...
3. **计划修复**: ...
```

## 严重程度分级标准

| 等级 | 标准 | 示例 |
|------|------|------|
| Critical | 可直接导致 RCE、数据泄露、完全绕过认证 | 反序列化 RCE、SQL注入获取全部数据 |
| High | 可导致重要数据泄露或权限提升 | XSS 窃取 session、SSRF 访问内网 |
| Medium | 需要特定条件才能利用 | CSRF、信息泄露、弱加密 |
| Low | 影响有限或利用难度极高 | 缺少安全头、详细错误信息 |
| Info | 最佳实践建议，非直接安全风险 | 代码质量、配置优化 |
